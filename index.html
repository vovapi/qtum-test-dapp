<!doctype html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta charset="utf-8">
        <script src="bundle.js" type='text/javascript'></script>        
        <title>Example test dapp</title>
    </head>
    <body>
            <script>
                    function send() {
                        let button = document.getElementById("send-btn");
                        button.disabled = true;
                        // sendtocontract
                        let contract = document.getElementById('contract').value;
                        let data = document.getElementById('data').value;
                        let amount = document.getElementById('amount').value;
                        let call = window.qrypto.rpcProvider.rawCall('sendtocontract', [contract, data, amount]);
                        
                        // Handle incoming messages
                        function handleMessage(message) {
                            if (message.data.target == 'qrypto-inpage') {
                                // result: object
                                // error: string
                                const { result, error } = message.data.message.payload;
                                
                                if (error) {
                                    if (error === 'Not logged in. Please log in to Qrypto first.') {
                                        // Show an alert dialog that the user needs to login first
                                        alert(error);
                                    } else {
                                        alert(error);
                                        // Handle different error than not logged in...
                                    }
                                    return;
                                }
                                console.log("result", result)
                                // Do something with the message result...
                            }
                        }
                        window.addEventListener('message', handleMessage, false);
                        call.then(function(result) {
                            console.log('success', result);
                            button.disabled = false;
                            button.value = "Success";
                            button.classList.remove("btn-primary")
                            button.classList.add("btn-success")
                        }, function(reason) {
                            console.log('fail', reason);
                            button.disabled = false;
                        })
                        return false;
                    }
                </script>
        <script>
            function executeCallback(id, result, error) {
                window.qrypto.rpcProvider.handleRpcCallResponse({id: id, result: result, error: error})
            }
        </script>
        <div class="container d-none" id="main">
            <div class="col p-3">
                <div class="card">
                    <div class="card-header">Account Info </div>
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="row">
                                <div class="col-sm"><b>Address: </b></div>
                                <div class="col" id="address">???</div>
                            </div>
                        </div>
                        <!-- <div class="list-group-item">
                            <div class="row">
                                <div class="col-sm"><b>Name: </b></div>
                                <div class="col"> <p id=name></p></div>
                            </div>
                        </div> -->
                        <!-- <div class="list-group-item">
                            <div class="row">
                                    <div class="col-sm"><b>Network: </b></div>
                                    <div class="col"> <p id=network></p></div>
                            </div>
                        </div> -->
                        <div class="list-group-item">
                            <div class="row">
                                <div class="col-sm"><b>Balance: </b></div>
                                <div class="col" id="balance">??? QTUM</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="m-3">
                        <form onsubmit="return send()">
                            <div class="form-group" style="display: none;">
                                <label for="contract">Contract:</label>
                                <input class="form-control" id="contract" type="text" value="49a941c5259e4e6ef9ac4a2a6716c1717ce0ffb6">
                            </div>
                            <div class="form-group" style="display: none;">
                                <label for="data">Data:</label>
                                <input class="form-control" id="data" type="text" value="d0821b0e0000000000000000000000000000000000000000000000000000000000000001">
                            </div>
                            <div class="form-group" style="display: none;">
                                <label for="amount">Amount:</label>
                                <input class="form-control" id="amount" type="text" value="1">
                            </div>
                            <input class="btn btn-primary btn-lg btn-block" type="submit" id="send-btn" value="Send Dapp transaction">
                        </form>
                    </div>
            </div>
        </div>
    </body>
</html>